#cloud-config
autoinstall:
  version: 1
  identity:
    hostname: {{ ubuntu_installer_hostname }}
    username: {{ ubuntu_installer_username }}
    password: {{ ubuntu_installer_password_hashed }}  # hashed password (e.g., mkpasswd -m sha-512)
  keyboard:
    layout: us
  locale: en_US
  reboot: true
  network:
    version: 2
    ethernets:
      enp1s0:
        match:
          name: e*
        set-name: enp1s0
        dhcp4: no
        addresses:
          - {{ ubuntu_installer_ip }}/{{ ubuntu_installer_host_prefix }}
        routes:
          - to: default
            via: {{ ubuntu_installer_host_gateway }}
        nameservers:
          addresses:
            - {{ ubuntu_installer_host_nameserver }}
  storage:
    layout:
      name: lvm
  ssh:
    install-server: true
  updates: security
  late-commands:
    - echo "root:{{ ubuntu_installer_password }}" | chpasswd
    - passwd -u root
    - sed -i '/^PermitRootLogin/d' /etc/ssh/sshd_config
    - echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config
    - sed -i '/^PasswordAuthentication/d' /etc/ssh/sshd_config
    - echo 'PasswordAuthentication yes' >> /etc/ssh/sshd_config
    - systemctl restart ssh || systemctl restart sshd || true
    - systemctl status ssh > /root/ssh_status.log 2>&1 || true
    - passwd -S root > /root/root_passwd_status.log
    - echo "Installation completed" > /root/install.log
 
    