#cloud-config
autoinstall:
  version: 1
  identity:
    hostname: {{ ubuntu_installer_hostname }}
    username: {{ ubuntu_installer_username }}
    password: {{ ubuntu_installer_password_hashed }}  # hashed password (e.g., mkpasswd -m sha-512)
  keyboard:
    layout: us
  locale: en_US
  reboot: true
  network:
    version: 2
    ethernets:
      enp1s0:
        match:
          name: e*
        set-name: enp1s0
        dhcp4: no
        addresses:
          - {{ ubuntu_installer_ip }}/{{ ubuntu_installer_host_prefix }}
        routes:
          - to: default
            via: {{ ubuntu_installer_host_gateway }}
        nameservers:
          addresses:
            - {{ ubuntu_installer_host_nameserver }}
  storage:
    layout:
      name: lvm
  ssh:
    install-server: true
    ssh_pwauth: true  # allow SSH password authentication
    allow-pw: true
    disable-root: false
  late-commands:
  - echo "root:{{ ubuntu_installer_password }}" | chroot /target chpasswd
  - sed -i '/^PermitRootLogin/d' /target/etc/ssh/sshd_config
  - echo 'PermitRootLogin yes' >> /target/etc/ssh/sshd_config
  - sed -i '/^PasswordAuthentication/d' /target/etc/ssh/sshd_config
  - echo 'PasswordAuthentication yes' >> /target/etc/ssh/sshd_config
  - chroot /target systemctl restart ssh
  - chroot /target update-initramfs -u
  
  
